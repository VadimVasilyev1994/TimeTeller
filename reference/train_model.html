<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Train the TimeTeller model — train_model • TimeTeller</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Train the TimeTeller model — train_model"><meta name="description" content="Trains the model using provided expression matrix and metadata."><meta property="og:description" content="Trains the model using provided expression matrix and metadata."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TimeTeller</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Basic_TimeTeller_Analysis.html">Basic_TimeTeller_Analysis</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/VadimVasilyev1994/TimeTeller/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Train the TimeTeller model</h1>
      <small class="dont-index">Source: <a href="https://github.com/VadimVasilyev1994/TimeTeller/blob/master/R/Main_functions.R" class="external-link"><code>R/Main_functions.R</code></a></small>
      <div class="d-none name"><code>train_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Trains the model using provided expression matrix and metadata.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">train_model</span><span class="op">(</span></span>
<span>  <span class="va">exp_matrix</span>,</span>
<span>  <span class="va">genes</span>,</span>
<span>  <span class="va">group_1</span>,</span>
<span>  <span class="va">group_2</span>,</span>
<span>  <span class="va">group_3</span>,</span>
<span>  <span class="va">time</span>,</span>
<span>  <span class="va">replicate</span>,</span>
<span>  mat_normalised <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  treat_independently <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  combine_for_norm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel_comp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"intergene"</span>,</span>
<span>  grouping_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>,</span>
<span>  num_PC <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  <span class="va">log_thresh</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  eta <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>  cov_estimate <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>  alpha_par <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  num_interp_points <span class="op">=</span> <span class="fl">144</span>,</span>
<span>  interp_method <span class="op">=</span> <span class="st">"perpchip"</span>,</span>
<span>  cov_path <span class="op">=</span> <span class="st">"spline"</span>,</span>
<span>  minpeakheight <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  minpeakdistance <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nups <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ndowns <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  npeaks <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-exp-matrix">exp_matrix<a class="anchor" aria-label="anchor" href="#arg-exp-matrix"></a></dt>
<dd><p>Matrix or data frame with features in rows and samples in columns</p></dd>


<dt id="arg-genes">genes<a class="anchor" aria-label="anchor" href="#arg-genes"></a></dt>
<dd><p>genes used to train the TimeTeller model</p></dd>


<dt id="arg-group-">group_1<a class="anchor" aria-label="anchor" href="#arg-group-"></a></dt>
<dd><p>vector containing metadata for each sample (eg individual, organ)</p></dd>


<dt id="arg-group-">group_2<a class="anchor" aria-label="anchor" href="#arg-group-"></a></dt>
<dd><p>vector containing metadata for each sample (eg individual, organ). Leave empty if unavailable</p></dd>


<dt id="arg-group-">group_3<a class="anchor" aria-label="anchor" href="#arg-group-"></a></dt>
<dd><p>vector containing metadata for each sample (eg individual, organ). Leave empty if unavailable</p></dd>


<dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>vector containing timing of each sample. Please appreciate the difference between CT and ZT</p></dd>


<dt id="arg-replicate">replicate<a class="anchor" aria-label="anchor" href="#arg-replicate"></a></dt>
<dd><p>vector containing replicate information if available</p></dd>


<dt id="arg-mat-normalised">mat_normalised<a class="anchor" aria-label="anchor" href="#arg-mat-normalised"></a></dt>
<dd><p>was the expression matrix supplied already normalised (eg RMA for microarray, CPM/TPM for RNA, etc) or not. If not, <code><a href="https://rdrr.io/pkg/edgeR/man/cpm.html" class="external-link">edgeR::cpm</a></code> function will be used (pseudocount of 2) to obtain log normalised values for downstream analysis. Default is TRUE</p></dd>


<dt id="arg-treat-independently">treat_independently<a class="anchor" aria-label="anchor" href="#arg-treat-independently"></a></dt>
<dd><p>should replicates be averaged (might be useful for technical replicates, not recommended for biological replicates). Default is TRUE</p></dd>


<dt id="arg-combine-for-norm">combine_for_norm<a class="anchor" aria-label="anchor" href="#arg-combine-for-norm"></a></dt>
<dd><p>should replicates be combined for normalisation. If TRUE, replicates will be combined for normalisation purposes (eg in <code>timecourse</code> normalisation, replicates will be combined and treated as one timeseries). Default is FALSE</p></dd>


<dt id="arg-parallel-comp">parallel_comp<a class="anchor" aria-label="anchor" href="#arg-parallel-comp"></a></dt>
<dd><p>if TRUE, parallel computation using <code>foreach</code> and <code>doParallel</code> packages will be used. Default is FALSE</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>if using parallel computation, how many cores should be used. Default is 4</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>method used for normalisation. Must be one of the <code>'intergene'</code>, <code>'timecourse'</code>, <code>'timecourse_matched'</code>, <code>'clr'</code></p></dd>


<dt id="arg-grouping-vars">grouping_vars<a class="anchor" aria-label="anchor" href="#arg-grouping-vars"></a></dt>
<dd><p>group variables (eg <code>'group_1'</code>, <code>'group_2'</code> or their combination <code>c('group_1','group_2')</code>) used for <code>timecourse_matched</code> normalisation</p></dd>


<dt id="arg-num-pc">num_PC<a class="anchor" aria-label="anchor" href="#arg-num-pc"></a></dt>
<dd><p>how many principal components should be used for the analysis. Default is 3</p></dd>


<dt id="arg-log-thresh">log_thresh<a class="anchor" aria-label="anchor" href="#arg-log-thresh"></a></dt>
<dd><p>log threshold selected. This is an important parameter and should be chosen carefully. Please read <code><a href="choose_logthresh_plot.html">help(choose_logthresh_plot)</a></code> for further information</p></dd>


<dt id="arg-epsilon">epsilon<a class="anchor" aria-label="anchor" href="#arg-epsilon"></a></dt>
<dd><p>hyperparameter value used in theta calculation. No reason to change this, more information at <a href="https://www.biorxiv.org/content/10.1101/2023.03.14.532177v1" class="external-link">https://www.biorxiv.org/content/10.1101/2023.03.14.532177v1</a>. Default is 0.40</p></dd>


<dt id="arg-eta">eta<a class="anchor" aria-label="anchor" href="#arg-eta"></a></dt>
<dd><p>hyperparameter value used in theta calculation. No reason to change this, more information at <a href="https://www.biorxiv.org/content/10.1101/2023.03.14.532177v1" class="external-link">https://www.biorxiv.org/content/10.1101/2023.03.14.532177v1</a>. Default is 0.35</p></dd>


<dt id="arg-cov-estimate">cov_estimate<a class="anchor" aria-label="anchor" href="#arg-cov-estimate"></a></dt>
<dd><p>type of covariance estimate used. If <code>'normal'</code> is selected, <code><a href="https://rdrr.io/pkg/Rfast/man/mvnorm.mle.html" class="external-link">Rfast::mvnorm.mle</a></code> will be used. If <code>'robust'</code> is selected, <code><a href="https://rdrr.io/pkg/rrcov/man/CovMcd.html" class="external-link">rrcov::CovMcd</a></code> will be used instead. This can be useful when there is a lot of training data, some of which is suspected to have high technical noise. Since we don't want to ignore biological noise (eg chronotype) and it's often hard to tell the two apart, default is <code>'normal'</code></p></dd>


<dt id="arg-alpha-par">alpha_par<a class="anchor" aria-label="anchor" href="#arg-alpha-par"></a></dt>
<dd><p>this is following <code>rrcov</code> package (in case <code>'robust'</code> was chosen above) and is the parameter controlling the size of the subsets over which the determinant will be minimized. Allowed values are between 0.5 and 1</p></dd>


<dt id="arg-num-interp-points">num_interp_points<a class="anchor" aria-label="anchor" href="#arg-num-interp-points"></a></dt>
<dd><p>number of interpolation points to use for the mean spline and covariance matrices. Default is 144 and this corresponds to 24 * 60 / 144 = 10 minutes</p></dd>


<dt id="arg-interp-method">interp_method<a class="anchor" aria-label="anchor" href="#arg-interp-method"></a></dt>
<dd><p>method used for spline interpolation. Must be one of the <code>'perpchip'</code> (which uses an adapted periodic version of <code>pchip</code> from <code>pracma</code> package) or <code>'standard'</code> (which uses periodic version of standard <code>spline</code> function from <code>splines</code> package).</p></dd>


<dt id="arg-cov-path">cov_path<a class="anchor" aria-label="anchor" href="#arg-cov-path"></a></dt>
<dd><p>method for covariance matrix interpolation. Must be one of the <code>'spline'</code> (in which case covariance matrix will be interpolated element-wise using <code>interp_method</code> selection) or <code>'fisherrao'</code> (in which case the geodesics based on the Fisher–Rao metric for Gaussian distributions will be used).</p></dd>


<dt id="arg-minpeakheight">minpeakheight<a class="anchor" aria-label="anchor" href="#arg-minpeakheight"></a></dt>
<dd><p>this is used internally with <code>pracma</code> package to locate peaks. No reason to change, however included for future testing / development. Please consult <code><a href="https://rdrr.io/pkg/pracma/man/findpeaks.html" class="external-link">?pracma::findpeaks</a></code>, if needed, for further information</p></dd>


<dt id="arg-minpeakdistance">minpeakdistance<a class="anchor" aria-label="anchor" href="#arg-minpeakdistance"></a></dt>
<dd><p>this is used internally with <code>pracma</code> package to locate peaks. No reason to change, however included for future testing / development</p></dd>


<dt id="arg-nups">nups<a class="anchor" aria-label="anchor" href="#arg-nups"></a></dt>
<dd><p>this is used internally with <code>pracma</code> package to locate peaks. No reason to change, however included for future testing / development</p></dd>


<dt id="arg-ndowns">ndowns<a class="anchor" aria-label="anchor" href="#arg-ndowns"></a></dt>
<dd><p>this is used internally with <code>pracma</code> package to locate peaks. No reason to change, however included for future testing / development</p></dd>


<dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd><p>this is used internally with <code>pracma</code> package to locate peaks. No reason to change, however included for future testing / development</p></dd>


<dt id="arg-npeaks">npeaks<a class="anchor" aria-label="anchor" href="#arg-npeaks"></a></dt>
<dd><p>this is used internally with <code>pracma</code> package to locate peaks. No reason to change, however included for future testing / development</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returned is the rich object of class <code>list</code> containing the TimeTeller model for further analysis</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Vlachou, D., Veretennikova, M., Usselmann, L., Vasilyev, V., Ott, S., Bjarnason, G.A., Dallmann, R., Levi, F. and Rand, D.A., 2023. TimeTeller: a tool to probe the circadian clock as a multigene dynamical system. bioRxiv, pp.2023-03.</p>
<p>Amari, S.I. and Nagaoka, H., 2000. Methods of information geometry (Vol. 191). American Mathematical Soc..</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Vadim Vasilyev</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/VadimVasilyev1994/TimeTeller" class="external-link">"TimeTeller"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tt_model</span> <span class="op">&lt;-</span> <span class="fu">train_model</span><span class="op">(</span>exp_matrix <span class="op">=</span> <span class="va">bjarn_data</span><span class="op">$</span><span class="va">expr_mat</span>, genes <span class="op">=</span> <span class="va">bjarn_data</span><span class="op">$</span><span class="va">probes_used</span>,</span></span>
<span class="r-in"><span>                        group_1 <span class="op">=</span> <span class="va">bjarn_data</span><span class="op">$</span><span class="va">group</span>, time <span class="op">=</span> <span class="va">bjarn_data</span><span class="op">$</span><span class="va">time</span>, log_thresh <span class="op">=</span> <span class="op">-</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Please check the information provided:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Number of genes used: 9  ( 202861_at 205251_at 209750_at 209782_s_at 209824_s_at 210971_s_at 213462_at 221045_s_at 39549_at )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Number of Group_1 levels: 10  ( Ind_1 Ind_2 Ind_3 Ind_4 Ind_5 Ind_6 Ind_7 Ind_8 Ind_9 Ind_10 )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Number of Group_2 levels: 1  ( NA )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Number of Group_2 levels: 1  ( NA )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Number of Replicate levels: 1  ( NA )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Number of unique time points Used for training: 6  ( 8 12 16 20 24 28 )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Replicates (if there are any) will be treated as independent observations for the training model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using intergene normalisation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Data loaded and successfully normalised</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating projections and interpolating densities...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using standard Covariance and Location estimation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating likelihoods...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Finished 1 of 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Finished 2 of 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Finished 3 of 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Finished 4 of 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Finished 5 of 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Finished 6 of 6 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculating additional info...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished!</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vadim Vasilyev.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

